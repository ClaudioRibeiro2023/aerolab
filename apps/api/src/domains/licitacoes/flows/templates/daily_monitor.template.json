{
  "template_id": "licitacoes_daily_monitor",
  "template_version": "0.1.0",
  "name": "Daily Monitor - Licitações",
  "description": "Fluxo diário de monitoramento de licitações públicas",
  "domain": "licitacoes",
  "schedule": "0 7 * * *",
  "state_defaults": {
    "mode": "monitor",
    "items": [],
    "changes": [],
    "scores": [],
    "digest": null,
    "result": {
      "status": "init",
      "run_id": null,
      "payload_json": "{}",
      "items_processed": 0,
      "items_p0": 0,
      "items_p1": 0,
      "errors": [],
      "warnings": []
    }
  },
  "config_schema": {
    "janela_dias": {
      "type": "integer",
      "default": 7,
      "min": 1,
      "max": 30
    },
    "limite_itens": {
      "type": "integer",
      "default": 100,
      "min": 10,
      "max": 500
    },
    "keywords": {
      "type": "array",
      "default": ["dengue", "drone", "geotecnologia"]
    },
    "ufs": {
      "type": "array",
      "default": []
    }
  },
  "nodes": [
    {
      "id": "start",
      "type": "start",
      "next": "watcher_search"
    },
    {
      "id": "watcher_search",
      "type": "agent",
      "agent": "watcher",
      "action": "search",
      "inputs": {
        "config": "{{cfg}}"
      },
      "outputs": {
        "items": "state.items",
        "changes": "state.changes"
      },
      "on_error": "handle_error",
      "next": "triage_score"
    },
    {
      "id": "triage_score",
      "type": "agent",
      "agent": "triage",
      "action": "score_items",
      "inputs": {
        "items": "{{state.items}}"
      },
      "outputs": {
        "scores": "state.scores"
      },
      "on_error": "handle_error",
      "next": "generate_digest"
    },
    {
      "id": "generate_digest",
      "type": "function",
      "function": "generate_daily_digest",
      "inputs": {
        "items": "{{state.items}}",
        "scores": "{{state.scores}}",
        "changes": "{{state.changes}}"
      },
      "outputs": {
        "digest": "state.digest"
      },
      "next": "persist_results"
    },
    {
      "id": "persist_results",
      "type": "function",
      "function": "persist_monitor_results",
      "inputs": {
        "items": "{{state.items}}",
        "scores": "{{state.scores}}",
        "digest": "{{state.digest}}"
      },
      "next": "finalize"
    },
    {
      "id": "handle_error",
      "type": "function",
      "function": "handle_flow_error",
      "inputs": {
        "error": "{{error}}",
        "node": "{{current_node}}"
      },
      "next": "finalize"
    },
    {
      "id": "finalize",
      "type": "end",
      "outputs": {
        "result": "state.result"
      }
    }
  ],
  "metadata": {
    "created_at": "2025-12-17",
    "author": "AeroLab",
    "tags": ["licitacoes", "monitor", "daily"]
  }
}
